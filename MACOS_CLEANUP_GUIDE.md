# macOS ç³»ç»Ÿæ¸…ç†æŒ‡å—

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒmacOS ä¼šè‡ªåŠ¨è®°å½•åº”ç”¨æ‰“å¼€çš„æ–‡ä»¶å¤¹åˆ°ç³»ç»Ÿçš„"æœ€è¿‘é¡¹ç›®"åˆ—è¡¨ä¸­ã€‚è¿™äº›è®°å½•ä¼šæ˜¾ç¤ºåœ¨ Dock èœå•çš„å³é”®èœå•ä¸­ï¼Œå¯èƒ½ä¼šæ³„éœ²å¼€å‘ç¯å¢ƒçš„æ•æ„Ÿè·¯å¾„ä¿¡æ¯ã€‚

### é—®é¢˜è¡¨ç°

å³é”®ç‚¹å‡» Dock ä¸­çš„åº”ç”¨å›¾æ ‡æ—¶ï¼Œä¼šæ˜¾ç¤ºï¼š
- æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶å¤¹è·¯å¾„
- æµ‹è¯•è·¯å¾„ï¼ˆå¦‚å¼€å‘æµ‹è¯•ä½¿ç”¨çš„æ–‡ä»¶å¤¹ï¼‰
- å¼€å‘ç¯å¢ƒä¸­çš„ç§æœ‰è·¯å¾„

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. è‡ªåŠ¨æ¸…ç†ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

åº”ç”¨å·²é›†æˆè‡ªåŠ¨æ¸…ç†åŠŸèƒ½ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è§¦å‘ï¼š

#### æ£€æµ‹å¼€å‘ç¯å¢ƒçš„æ¡ä»¶
- è®¾ç½®äº†ç¯å¢ƒå˜é‡ `PLOOKINGII_DEV=1`
- åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œ
- ä»æºç ç›®å½•è¿è¡Œï¼ˆå­˜åœ¨ `.git` ç›®å½•ï¼‰

#### è‡ªåŠ¨æ¸…ç†æ—¶æœº
- **åº”ç”¨é€€å‡ºæ—¶**ï¼šè‡ªåŠ¨æ¸…ç†æ‰€æœ‰æœ€è¿‘æ–‡æ¡£è®°å½•

#### å®ç°æ–¹å¼
```python
# åœ¨ plookingII/app/main.py ä¸­
def applicationShouldTerminate_(self, sender):
    # ... å…¶ä»–æ¸…ç†é€»è¾‘ ...
    
    # å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨æ¸…ç† macOS æœ€è¿‘æ–‡æ¡£è®°å½•
    from ..utils.macos_cleanup import MacOSCleanupManager
    MacOSCleanupManager.auto_cleanup_if_dev()
    
    return True
```

### 2. æ‰‹åŠ¨æ¸…ç†

#### ä½¿ç”¨æ¸…ç†è„šæœ¬

```bash
# è¿è¡Œæ¸…ç†è„šæœ¬
make clear-recent

# æˆ–ç›´æ¥è¿è¡Œ
python3 scripts/clear_recent_items.py
```

#### æ¸…ç†å†…å®¹

è„šæœ¬ä¼šæ¸…ç†ä»¥ä¸‹å†…å®¹ï¼š
- âœ… macOS ç³»ç»Ÿæœ€è¿‘æ–‡æ¡£åˆ—è¡¨
- âœ… NSDocumentController è®°å½•
- âœ… Dock èœå•æ˜¾ç¤ºçš„æœ€è¿‘é¡¹ç›®
- âœ… åº”ç”¨å†…éƒ¨æœ€è¿‘æ–‡ä»¶å¤¹æ•°æ®åº“

### 3. ä»£ç ä¸­ä½¿ç”¨

```python
from plookingII.utils.macos_cleanup import MacOSCleanupManager

# æ£€æµ‹æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒ
is_dev = MacOSCleanupManager.is_development_environment()

# æ¸…ç† macOS ç³»ç»Ÿæœ€è¿‘æ–‡æ¡£
MacOSCleanupManager.clear_recent_documents()

# æ¸…ç†åº”ç”¨æœ€è¿‘æ–‡æ¡£
MacOSCleanupManager.clear_app_recent_documents()

# å¦‚æœåœ¨å¼€å‘ç¯å¢ƒï¼Œè‡ªåŠ¨æ¸…ç†
MacOSCleanupManager.auto_cleanup_if_dev()
```

## ğŸ”§ æŠ€æœ¯å®ç°

### æ¸…ç†æ–¹æ³•

#### 1. NSRecentDocumentRecords
```python
from Foundation import NSUserDefaults
defaults = NSUserDefaults.standardUserDefaults()
defaults.removeObjectForKey_("NSRecentDocumentRecords")
defaults.synchronize()
```

#### 2. AppleScript é‡ç½®
```applescript
tell application "System Events"
    tell appearance preferences
        set recent documents limit to 0
        set recent applications limit to 0
        set recent servers limit to 0
    end tell
end tell
```

#### 3. NSDocumentController
```python
from Foundation import NSDocumentController
doc_controller = NSDocumentController.sharedDocumentController()
doc_controller.clearRecentDocuments_(None)
```

#### 4. åº”ç”¨æ•°æ®åº“
```python
from plookingII.services.recent import RecentFoldersManager
manager = RecentFoldersManager()
manager.clear()
manager.cleanup_invalid_entries()
```

### å¼€å‘ç¯å¢ƒæ£€æµ‹

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹ç‰¹å¾ï¼š

1. **ç¯å¢ƒå˜é‡**
   ```bash
   export PLOOKINGII_DEV=1
   ```

2. **è™šæ‹Ÿç¯å¢ƒ**
   - æ£€æµ‹ `sys.real_prefix`
   - æ£€æµ‹ `sys.base_prefix != sys.prefix`

3. **æºç ç›®å½•**
   - æ£€æµ‹ `.git` ç›®å½•çš„å­˜åœ¨

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å¼€å‘æ—¶è®¾ç½®

```bash
# 1. è®¾ç½®å¼€å‘ç¯å¢ƒæ ‡å¿—
export PLOOKINGII_DEV=1

# 2. æ­£å¸¸è¿è¡Œåº”ç”¨
python3 -m plookingII

# 3. åº”ç”¨é€€å‡ºæ—¶ä¼šè‡ªåŠ¨æ¸…ç†
```

### æ‰‹åŠ¨æ¸…ç†

```bash
# ç«‹å³æ¸…ç†æ‰€æœ‰æœ€è¿‘é¡¹ç›®è®°å½•
make clear-recent
```

### è¾“å‡ºç¤ºä¾‹

```
======================================================================
ğŸ§¹ PlookingII - macOS æœ€è¿‘é¡¹ç›®æ¸…ç†å·¥å…·
======================================================================

æ­£åœ¨æ£€æµ‹è¿è¡Œç¯å¢ƒ...
âœ… æ£€æµ‹åˆ°å¼€å‘ç¯å¢ƒ

æ­£åœ¨æ¸…ç†æœ€è¿‘é¡¹ç›®è®°å½•...
----------------------------------------------------------------------
1. æ¸…ç† macOS ç³»ç»Ÿæœ€è¿‘æ–‡æ¡£...
   âœ… ç³»ç»Ÿæœ€è¿‘æ–‡æ¡£å·²æ¸…ç†
2. æ¸…ç†åº”ç”¨æœ€è¿‘æ–‡æ¡£...
   âœ… åº”ç”¨æœ€è¿‘æ–‡æ¡£å·²æ¸…ç†
3. æ¸…ç†åº”ç”¨æ•°æ®åº“æœ€è¿‘è®°å½•...
   âœ… å·²æ¸…ç†æ•°æ®åº“è®°å½• (ç§»é™¤ 0 æ¡æ— æ•ˆè®°å½•)

----------------------------------------------------------------------
âœ… æ¸…ç†å®Œæˆï¼

æ¸…ç†å†…å®¹:
  â€¢ macOS ç³»ç»Ÿæœ€è¿‘æ–‡æ¡£åˆ—è¡¨
  â€¢ NSDocumentController è®°å½•
  â€¢ Dock èœå•æ˜¾ç¤ºçš„æœ€è¿‘é¡¹ç›®
  â€¢ åº”ç”¨å†…éƒ¨æœ€è¿‘æ–‡ä»¶å¤¹æ•°æ®åº“

æ³¨æ„:
  â€¢ Dock èœå•å¯èƒ½éœ€è¦é‡å¯åº”ç”¨åæ‰ä¼šæ›´æ–°
  â€¢ éƒ¨åˆ†ç³»ç»Ÿè®¾ç½®éœ€è¦é‡æ–°ç™»å½•æ‰èƒ½å®Œå…¨ç”Ÿæ•ˆ

======================================================================
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Dock èœå•æ›´æ–°
- Dock èœå•å¯èƒ½éœ€è¦é‡å¯åº”ç”¨åæ‰ä¼šæ›´æ–°
- éƒ¨åˆ†ç³»ç»Ÿè®¾ç½®éœ€è¦é‡æ–°ç™»å½•æ‰èƒ½å®Œå…¨ç”Ÿæ•ˆ

### 2. ç”Ÿäº§ç¯å¢ƒ
- ç”Ÿäº§ç¯å¢ƒï¼ˆå‘å¸ƒçš„ .app åŒ…ï¼‰**ä¸ä¼š**è‡ªåŠ¨æ¸…ç†
- ç”¨æˆ·çš„æœ€è¿‘é¡¹ç›®è®°å½•ä¼šæ­£å¸¸ä¿ç•™
- åªæœ‰å¼€å‘ç¯å¢ƒæ‰ä¼šè§¦å‘è‡ªåŠ¨æ¸…ç†

### 3. æ¸…ç†æ—¶æœº
- æ¨èåœ¨æ¯æ¬¡å¼€å‘æµ‹è¯•ç»“æŸåæ‰‹åŠ¨æ¸…ç†
- æˆ–ä¾èµ–åº”ç”¨é€€å‡ºæ—¶çš„è‡ªåŠ¨æ¸…ç†
- é¿å…å°†æµ‹è¯•è·¯å¾„æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶æˆ–å‘å¸ƒ

## ğŸ“š ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒå®ç°
- `plookingII/utils/macos_cleanup.py` - æ¸…ç†å·¥å…·å®ç°
- `scripts/clear_recent_items.py` - æ¸…ç†è„šæœ¬
- `plookingII/app/main.py` - åº”ç”¨é€€å‡ºæ—¶çš„æ¸…ç†é€»è¾‘

### é…ç½®
- `Makefile` - `make clear-recent` å‘½ä»¤
- `pyproject.toml` - Ruff é…ç½®ï¼ˆå¿½ç•¥ print è¯­å¥ï¼‰

### æ–‡æ¡£
- `MACOS_CLEANUP_GUIDE.md` - æœ¬æ–‡æ¡£

## ğŸ¯ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒæ¨èè®¾ç½®

```bash
# .zshrc æˆ– .bashrc ä¸­æ·»åŠ 
export PLOOKINGII_DEV=1

# ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate
```

### CI/CD ç¯å¢ƒ

```yaml
# .github/workflows/ci.yml
env:
  PLOOKINGII_DEV: 1
```

### æµ‹è¯•å‰æ¸…ç†

```bash
# æµ‹è¯•å‰æ¸…ç†å†å²è®°å½•
make clear-recent

# è¿è¡Œæµ‹è¯•
make test

# æµ‹è¯•åå†æ¬¡æ¸…ç†
make clear-recent
```

## ğŸ” éšç§ä¿æŠ¤

### ä¿æŠ¤å†…å®¹
- âœ… å¼€å‘è€…çš„æµ‹è¯•è·¯å¾„
- âœ… ç§æœ‰æ–‡ä»¶å¤¹åç§°
- âœ… å¼€å‘ç¯å¢ƒçš„æ–‡ä»¶ç»“æ„
- âœ… æ•æ„Ÿçš„é¡¹ç›®è·¯å¾„

### ä¸å½±å“
- âœ… åº”ç”¨å†…éƒ¨çš„æœ€è¿‘æ–‡ä»¶å¤¹åŠŸèƒ½ï¼ˆä»ç„¶æ­£å¸¸å·¥ä½œï¼‰
- âœ… ç”¨æˆ·åœ¨ç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨ä½“éªŒ
- âœ… åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½

## âœ¨ æ€»ç»“

é€šè¿‡é›†æˆçš„æ¸…ç†ç³»ç»Ÿï¼š
1. **è‡ªåŠ¨åŒ–**ï¼šå¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨æ¸…ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
2. **å®‰å…¨æ€§**ï¼šé¿å…å¼€å‘è·¯å¾„æ³„éœ²åˆ°ç‰ˆæœ¬æ§åˆ¶æˆ–å‘å¸ƒåŒ…
3. **çµæ´»æ€§**ï¼šæ”¯æŒæ‰‹åŠ¨æ¸…ç†å’Œè‡ªåŠ¨æ¸…ç†ä¸¤ç§æ¨¡å¼
4. **é€æ˜æ€§**ï¼šæ¸…æ™°çš„æ—¥å¿—è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•å’Œç¡®è®¤

---

**ç»´æŠ¤è€…**: PlookingII Team  
**ç‰ˆæœ¬**: 1.6.0  
**æœ€åæ›´æ–°**: 2025-10-06

