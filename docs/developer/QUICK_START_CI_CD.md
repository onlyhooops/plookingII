# CI/CDä¸æ¶æ„å®ˆæŠ¤å¿«é€Ÿå¼€å§‹æŒ‡å—

> 5åˆ†é’Ÿå†…å¿«é€Ÿäº†è§£å’Œä½¿ç”¨PlookingIIçš„CI/CDä¸æ¶æ„å®ˆæŠ¤ç³»ç»Ÿ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æœ¬åœ°å¼€å‘æ£€æŸ¥

```bash
# å®‰è£…å¼€å‘ä¾èµ–
make install-dev

# å®‰è£…pre-commité’©å­ï¼ˆä¸€æ¬¡æ€§ï¼‰
make pre-commit

# å¿«é€Ÿæ£€æŸ¥ï¼ˆæäº¤å‰ï¼‰
make quick-check
```

### 2. æäº¤ä»£ç 

```bash
# æ­£å¸¸æäº¤ï¼ˆè‡ªåŠ¨è¿è¡Œpre-commitæ£€æŸ¥ï¼‰
git add .
git commit -m "feat: your feature"

# å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œä¿®å¤åé‡æ–°æäº¤
# pre-commitä¼šè‡ªåŠ¨ä¿®å¤ä¸€äº›é—®é¢˜
git add .
git commit -m "feat: your feature"
```

### 3. æ¨é€åˆ°è¿œç¨‹

```bash
# æ¨é€ä»£ç ï¼ˆè§¦å‘CI/CDï¼‰
git push

# æŸ¥çœ‹GitHub Actionsè¿è¡ŒçŠ¶æ€
# https://github.com/your-repo/actions
```

---

## ğŸ“‹ å¯ç”¨å‘½ä»¤é€ŸæŸ¥

### æµ‹è¯•å‘½ä»¤

```bash
make test              # è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test-arch        # è¿è¡Œæ¶æ„æµ‹è¯•
make test-quality     # è¿è¡Œä»£ç è´¨é‡æµ‹è¯•
make test-coverage    # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

### ä»£ç è´¨é‡

```bash
make guard            # æ¶æ„å®ˆæŠ¤æ£€æŸ¥
make lint             # ä»£ç æ£€æŸ¥
make format           # ä»£ç æ ¼å¼åŒ–
make type-check       # ç±»å‹æ£€æŸ¥
make complexity       # å¤æ‚åº¦æ£€æŸ¥
make security         # å®‰å…¨æ£€æŸ¥
```

### CIæ¨¡æ‹Ÿ

```bash
make quick-check      # å¿«é€Ÿæ£€æŸ¥ï¼ˆæäº¤å‰ï¼‰
make ci               # å®Œæ•´CIæµç¨‹ï¼ˆæœ¬åœ°ï¼‰
make full-check       # å®Œæ•´æ£€æŸ¥ï¼ˆå‘å¸ƒå‰ï¼‰
```

### æ¸…ç†

```bash
make clean            # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
make clean-all        # æ·±åº¦æ¸…ç†
```

---

## ğŸ›¡ï¸ æ¶æ„å®ˆæŠ¤

### ä»€ä¹ˆæ˜¯æ¶æ„å®ˆæŠ¤ï¼Ÿ

æ¶æ„å®ˆæŠ¤æ˜¯ä¸€å¥—è‡ªåŠ¨åŒ–æ£€æŸ¥ç³»ç»Ÿï¼Œç¡®ä¿ï¼š
- âœ… å·²å¼ƒç”¨çš„æ¨¡å—ä¸è¢«é‡æ–°å¼•å…¥
- âœ… ä»£ç ä¸ä½¿ç”¨å·²å¼ƒç”¨çš„å¯¼å…¥
- âœ… æ ¸å¿ƒæ¨¡å—å®Œæ•´æ€§
- âœ… ç‰ˆæœ¬ä¸€è‡´æ€§
- âœ… ä»£ç è´¨é‡æ ‡å‡†
- âœ… å®‰å…¨åŸºçº¿

### å¦‚ä½•è¿è¡Œï¼Ÿ

```bash
# ç›´æ¥è¿è¡Œ
python3 tools/architecture_guard.py

# æˆ–ä½¿ç”¨Makeå‘½ä»¤
make guard
```

### è¾“å‡ºè§£è¯»

```
âœ… é€šè¿‡ (6):      # 6é¡¹æ£€æŸ¥é€šè¿‡
âš ï¸ è­¦å‘Š (1):      # 1é¡¹è­¦å‘Šï¼ˆå»ºè®®ä¿®å¤ï¼‰
âŒ é”™è¯¯ (0):      # 0é¡¹é”™è¯¯ï¼ˆå¿…é¡»ä¿®å¤ï¼‰
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### æŸ¥çœ‹è¦†ç›–ç‡

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”ŸæˆHTMLæŠ¥å‘Š
make test-coverage

# æ‰“å¼€æŠ¥å‘Š
open htmlcov/index.html
```

### è¦†ç›–ç‡è¦æ±‚

- **æœ€ä½:** 40%ï¼ˆå¼ºåˆ¶ï¼‰
- **ç›®æ ‡:** 60%+
- **æ ¸å¿ƒæ¨¡å—:** 70%+

---

## ğŸ”§ Pre-commit Hooks

### å®‰è£…

```bash
# æ–¹å¼1ï¼šä½¿ç”¨Make
make pre-commit

# æ–¹å¼2ï¼šç›´æ¥å®‰è£…
pip install pre-commit
pre-commit install
```

### åŒ…å«çš„æ£€æŸ¥

1. **Ruff** - ä»£ç æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤
2. **Black** - ä»£ç æ ¼å¼åŒ–
3. **isort** - å¯¼å…¥æ’åº
4. **Bandit** - å®‰å…¨æ‰«æ
5. **Mypy** - ç±»å‹æ£€æŸ¥
6. **æ¶æ„å®ˆæŠ¤** - è‡ªå®šä¹‰æ£€æŸ¥
7. **å¿«é€Ÿæµ‹è¯•** - æ¶æ„æµ‹è¯•

### è·³è¿‡æ£€æŸ¥ï¼ˆä¸æ¨èï¼‰

```bash
# ç´§æ€¥æƒ…å†µä¸‹è·³è¿‡pre-commit
git commit --no-verify -m "urgent fix"
```

---

## ğŸ“ˆ CI/CDæµç¨‹

### è§¦å‘æ¡ä»¶

- **Pushåˆ°ä»»ä½•åˆ†æ”¯** â†’ è¿è¡Œå®Œæ•´æµ‹è¯•
- **Pull Request** â†’ è¿è¡Œå®Œæ•´æµ‹è¯•
- **Push tag (v*)** â†’ æ„å»ºå¹¶å‘å¸ƒ

### CIæµç¨‹æ­¥éª¤

1. âœ… æ¶æ„å®ˆæŠ¤æ£€æŸ¥
2. âœ… æ¶æ„æµ‹è¯•
3. âœ… ä»£ç è´¨é‡æµ‹è¯•
4. âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ˆå¸¦è¦†ç›–ç‡ï¼‰
5. âœ… ä»£ç é£æ ¼æ£€æŸ¥
6. âœ… å¤æ‚åº¦æ£€æŸ¥
7. âœ… ç±»å‹æ£€æŸ¥
8. âœ… å®‰å…¨å®¡è®¡
9. âœ… ç”ŸæˆæŠ¥å‘Š
10. âœ… æ„å»ºåº”ç”¨ï¼ˆtagæ—¶ï¼‰

### æŸ¥çœ‹ç»“æœ

```
GitHub â†’ Actions â†’ é€‰æ‹©workflow â†’ æŸ¥çœ‹è¯¦æƒ…
```

---

## â“ å¸¸è§é—®é¢˜

### Q: Pre-commitæ£€æŸ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** 
1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
2. è¿è¡Œ `make format` è‡ªåŠ¨ä¿®å¤æ ¼å¼é—®é¢˜
3. æ‰‹åŠ¨ä¿®å¤å…¶ä»–é—®é¢˜
4. é‡æ–°æäº¤

### Q: å¦‚ä½•åªè¿è¡Œæ¶æ„æµ‹è¯•ï¼Ÿ

**A:**
```bash
make test-arch
# æˆ–
python3 -m pytest tests/test_architecture.py -v
```

### Q: å¦‚ä½•ä¸´æ—¶è·³è¿‡æŸä¸ªæ£€æŸ¥ï¼Ÿ

**A:** 
```bash
# è·³è¿‡pre-commitï¼ˆä¸æ¨èï¼‰
git commit --no-verify

# è·³è¿‡ç‰¹å®šæµ‹è¯•
pytest -k "not test_name"
```

### Q: CIæ£€æŸ¥å¤±è´¥ä½†æœ¬åœ°é€šè¿‡ï¼Ÿ

**A:** å¸¸è§åŸå› ï¼š
1. ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´ â†’ æ›´æ–°requirements.txt
2. ç¯å¢ƒå·®å¼‚ â†’ ä½¿ç”¨ç›¸åŒPythonç‰ˆæœ¬(3.11)
3. ç¼“å­˜é—®é¢˜ â†’ æ¸…ç†å¹¶é‡æ–°è¿è¡Œ

### Q: å¦‚ä½•æé«˜æµ‹è¯•è¦†ç›–ç‡ï¼Ÿ

**A:**
1. æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š: `make test-coverage`
2. ä¸ºæœªè¦†ç›–çš„ä»£ç æ·»åŠ æµ‹è¯•
3. é‡ç‚¹å…³æ³¨æ ¸å¿ƒæ¨¡å—
4. è¿è¡Œå¹¶éªŒè¯æ–°è¦†ç›–ç‡

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

### ä¸»è¦æ–‡æ¡£

- **[æ¶æ„å®ˆæŠ¤è¯¦ç»†æŒ‡å—](ARCHITECTURE_GUARD.md)** - å®Œæ•´ä½¿ç”¨è¯´æ˜
- **[CI/CDå®ŒæˆæŠ¥å‘Š](CI_CD_ARCHITECTURE_GUARD_COMPLETE.md)** - ç³»ç»Ÿæ¦‚è¿°
- **[æœ¬å¿«é€ŸæŒ‡å—](QUICK_START_CI_CD.md)** - å¿«é€Ÿå¼€å§‹

### ä»£ç ç¤ºä¾‹

```bash
# å®Œæ•´çš„å¼€å‘å·¥ä½œæµ
git checkout -b feature/new-feature
# ... å¼€å‘ä»£ç  ...
make quick-check           # å¿«é€Ÿæ£€æŸ¥
git add .
git commit -m "feat: add new feature"  # è‡ªåŠ¨è¿è¡Œpre-commit
git push origin feature/new-feature
# ... åˆ›å»ºPull Request ...
# CI/CDè‡ªåŠ¨è¿è¡Œ
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### æäº¤å‰

1. âœ… è¿è¡Œ `make quick-check`
2. âœ… ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
3. âœ… æ£€æŸ¥ä»£ç è¦†ç›–ç‡
4. âœ… æäº¤æœ‰æ„ä¹‰çš„commit message

### æäº¤æ—¶

1. âœ… è®©pre-commitè‡ªåŠ¨è¿è¡Œ
2. âœ… ä¿®å¤pre-commitå‘ç°çš„é—®é¢˜
3. âœ… ä¸è¦ä½¿ç”¨ `--no-verify`

### æ¨é€å

1. âœ… æŸ¥çœ‹CI/CDè¿è¡ŒçŠ¶æ€
2. âœ… ä¿®å¤CIå‘ç°çš„é—®é¢˜
3. âœ… ç¡®ä¿æ‰€æœ‰æ£€æŸ¥é€šè¿‡

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **GitHub Actions:** `.github/workflows/`
- **æµ‹è¯•æ–‡ä»¶:** `tests/test_architecture.py`, `tests/test_code_quality.py`
- **å·¥å…·è„šæœ¬:** `tools/architecture_guard.py`
- **é…ç½®æ–‡ä»¶:** `pytest.ini`, `mypy.ini`, `.flake8`, `pyproject.toml`

---

## ğŸ’¡ æç¤º

### åŠ é€Ÿå¼€å‘

```bash
# åˆ›å»ºåˆ«åï¼ˆæ·»åŠ åˆ° ~/.zshrc æˆ– ~/.bashrcï¼‰
alias mq="make quick-check"
alias mt="make test"
alias mg="make guard"
alias mc="make clean"
```

### è‡ªåŠ¨åŒ–å·¥ä½œæµ

```bash
# ä¸€é”®å®Œæˆï¼šæ ¼å¼åŒ– + æµ‹è¯• + æäº¤
make format && make quick-check && git add . && git commit
```

---

**ç»´æŠ¤è€…:** PlookingII Team  
**æ›´æ–°æ—¶é—´:** 2025-10-01  
**é€‚ç”¨ç‰ˆæœ¬:** 1.4.0+

æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹ [è¯¦ç»†æ–‡æ¡£](ARCHITECTURE_GUARD.md) æˆ–æäº¤ Issueã€‚

